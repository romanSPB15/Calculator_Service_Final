# Веб-сервис для вычисления арифметических выражений на Golang

## Описание

Программа представляет собой API-сервис для конкурентного вычисления выражений с GRPC.

## Предназначение

Пользователь хочет считать арифметические выражения. Он вводит строку `2 + 2 * 2` и хочет получить в ответ `6`.<br>
Но наши операции сложения и умножения (также деления и вычитания) выполняются "очень-очень" долго(*симуляция*).<br>
Поэтому вариант, при котором пользователь делает *GRPC-запрос* и получает в качетсве ответа результат, невозможна.<br>
Более того, вычисление каждой такой операции в нашей "альтернативной реальности" занимает *"гигантские" вычислительные мощности*.<br>
Соответственно, каждое действие мы должны уметь выполнять отдельно и масштабировать эту систему можем добавлением вычислительных мощностей в нашу систему в виде новых "машин".<br>
Поэтому пользователь может с какой-то периодичностью уточнять у сервера "не посчиталость ли выражение"?<br>
Если выражение наконец будет вычислено - то он получит результат.<br>

## Установка

 - Для установки нужно выбрать директорию проекта:
```bash
cd <your_dir>
```
 - Потом необходимо выполнить эту команду:
```bash
git clone https://github.com/romanSPB15/Calculator_Service_Final
```
 - В выбранной папке появится папка ```Calculator_Service_Final``` c проектом.

## Работа с API

### Конфигурация
#### Переменные среды
Сначала необходимо открыть файл ```./config/.env``` и установить параметры:

 - **TIME_ADDITION_MS** - время вычисления сложения(в миллисекундах);

 - **TIME_SUBTRACTION_MS** - время вычисления вычитания;

 - **TIME_MULTIPLICATIONS_MS** - время вычисления умножения;

 - **TIME_DIVISIONS_MS** - время вычисления деления;

 - **COMPUTING_POWER** - максмальное количество *worker*'ов, которые параллельно выполняют арифметические действия.

#### Другие параметры

Потом необходимо открыть файл ```.json``` в той же папке и установить следущие параметры(**true** - включено, **false** - выключено):

 - ```debug``` - отладка(вывод событий в лог)

 - ```web``` - веб-интерфейс(об его использовании читайте дальше в **Веб-интерфейс**) // Пока НЕ работает

По умолчанию и то и другое выключено.

### Запуск
 - Для запуска API необходимо выбрать директорию проекта:
```
cd <путь к папке Calculator_Service_Final>
```
 - Далее надо запустить файл ```cmd/main.go```:
```
go run cmd/main.go
```

### Управление

Для *регистрации* и *входа* через терминал с помощью *Curl* настоятельно рекомендую использовать **Git Bash**.<br> Но можно использовать и **Postman** - приложение для отправки *HTTP-запросов*, по-моему в нём работать проще.

Для работы с данным сервисом, нужно именть GRPC-клиента для **самой работы** и HTTP для **входа/регистрации**. *Proto-файлы* находятся в папке ```proto```.
Для тестирования можно использовать готового клиента, код которого находится в папке ```test_client```, а ```test_client.exe``` в корне.

 - Токен *"протухает"* за **10 суток**.

### Регистрация

Пользователь отправляет запрос **POST** ```/api/v1/register```
```
{ "login": "mylogin", "password": "mypassword"}
```

В ответ получает 200 OK (в случае успеха), а 422 в случае ошибки:

- **Неправильный метод**(должен быть **только POST**): ```method not allowed```.
- **Неправильное тело запроса**: ```invalid body```.
- **Такой пользователь уже существует** ```user already exists```.
- **Короткий пароль** (меньше **5 символов**): ```short password```.


### Вход

Пользователь отправляет запрос **POST** ```/api/v1/login```
```
{ "login": , "password": }
```

В ответ получает 200 OK и **JWT-токен для последующей авторизации**, а 422 в случае ошибки.

- **Неправильный метод**(должен быть **только POST**): ```method not allowed```
- **Неправильное тело запроса**: ```invalid body```
- **Невалидное имя или пароль:** ```invalid login or password```

### Веб-интерфейс // Пока НЕ работает

Вот ссылки на веб-страницы:

 - [Главная страница](http://localhost:8080/api/v1/web)
 - [Вычисление выражения](http://localhost:8080/api/v1/web/calculate)
 - [Просмотр всех выражений](http://localhost:8080/api/v1/web/expressions)
 - [Просмотр выражения по его ID](http://localhost:8080/api/v1/web/expression)

****ВАЖНО:**** По умолчанию веб-интерфейс выключен. Чтобы его включить, нужно изменить параметр *Веб интерфейс* в **Конфигурация/Другие Параметры**.
